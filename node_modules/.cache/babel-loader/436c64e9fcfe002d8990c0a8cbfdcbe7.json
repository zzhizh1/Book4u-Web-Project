{"ast":null,"code":"var _jsxFileName = \"/Users/kejingwang/Desktop/CIS550Database/AllProjects/Project550New/client/src/components/Subpage.js\";\nimport React from 'react';\nimport { withRouter } from \"react-router-dom\";\nimport '../style/Subpage.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport PageNavbar from './PageNavbar';\nimport StarIcon from \"../assets/images/star.png\";\nimport StarRatingComponent from 'react-star-rating-component';\nimport Carousel from 'react-multi-carousel';\nimport 'react-multi-carousel/lib/styles.css';\n\nclass Subpage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      username: window.localStorage.getItem(\"username\"),\n      ISBN: this.props.location.state.ISBN,\n      //ISBN: from the props.history.push in Dashboard/Rec code, the ISBN of book clicked\n      book: {},\n      //detailed book info: title, author, publisher, year, image_url_l\n      prevRating: false,\n      //if user previously rated the book \n      curRating: 0,\n      //star num clicked, 0 star means that user hasn't selected anything\n      avgRating: 0,\n      //average rating of this ISBN\n      relatedBooks: [] //contains book info of the same author\n\n    };\n    this.getRelatedBooks = this.getRelatedBooks.bind(this);\n    this.sumbitRating = this.sumbitRating.bind(this);\n    this.addToBookshelf = this.addToBookshelf.bind(this);\n    this.goToSubpage = this.goToSubpage.bind(this);\n  }\n\n  componentDidMount() {\n    //GET BOOK BY ISBN\n    fetch(`http://localhost:8081/book/${this.state.ISBN}`, {\n      method: 'GET'\n    }).then(res => res.json()).then(resArray => {\n      if (!resArray) return;\n      this.setState({\n        book: resArray[0]\n      });\n    }).catch(err => console.log(err)); // Print the error if there is one. \n    //GET AVERAGE RATING BY ISBN\n\n    fetch(`http://localhost:8081/avgRating/${this.state.ISBN}`, {\n      method: 'GET'\n    }).then(res => res.json()).then(resArray => {\n      if (!resArray) return;\n      this.setState({\n        avgRating: resArray[0].avgRating\n      });\n    }).catch(err => console.log(err)); // Print the error if there is one.\n    //GET PREVIOUS RATING OF USER ON THIS ISBN\n\n    fetch(`http://localhost:8081/userRating/${this.state.username}/${this.state.ISBN}`, {\n      method: 'GET'\n    }).then(res => res.json()).then(resArray => {\n      if (resArray.length > 0) {\n        //not an empty array\n        this.setState({\n          prevRating: true,\n          curRating: resArray[0].rating\n        });\n      }\n    }).catch(err => console.log(err)); //GET BOOKS OF SAME AUTHOR\n\n    this.getRelatedBooks();\n  } // Send an HTTP request to the server.\n  // fetch(\"http://localhost:8081/genres\", {\n  //   method: 'GET' // The type of HTTP request.\n  // })\n  //   .then(res => res.json()) // Convert the response data to a JSON.\n  //   .then(genreList => {\n  //     if (!genreList) return;\n  //     // Map each genreObj in genreList to an HTML element:\n  //     // A button which triggers the showMovies function for each genre.\n  //     let genreDivs = genreList.map((genreObj, i) =>\n  //       <GenreButton id={\"button-\" + genreObj.genre} onClick={() => this.showMovies(genreObj.genre)} genre={genreObj.genre} />\n  //     );\n  //     // Set the state of the genres list to the value returned by the HTTP response from the server.\n  //     this.setState({\n  //       genres: genreDivs\n  //     })\n  //   })\n  //   .catch(err => console.log(err))\t// Print the error if there is one.\n\n\n  onStarClick(nextValue, prevValue, name) {\n    this.setState({\n      curRating: nextValue\n    });\n  }\n\n  sumbitRating() {\n    if (!this.state.username) {\n      alert(\"Please log in first!\");\n    } else if (this.state.curRating == 0) {\n      alert(\"Please select a number!\");\n    } else if (!this.state.ISBN) {\n      alert(\"Error\");\n    } //if no previous rating exists in db, insertion query\n\n\n    if (!this.state.prevRating) {\n      fetch(`http://localhost:8081/submitRating/${this.state.username}/${this.state.ISBN}/${this.state.curRating}`, {\n        method: 'GET'\n      }).then(res => res.json()).then(res => {\n        //res is {status: \"success\"} if server -> db is sucessful\n        if (res.status == \"success\") {\n          this.setState({\n            prevRating: true\n          });\n          alert(\"Rating submitted\");\n        } else {\n          alert(\"DB Query Error\");\n        }\n      }).catch(err => console.log(err)); //If exists previous rating in db, UPDATE query\n    } else {\n      fetch(`http://localhost:8081/updateRating/${this.state.username}/${this.state.ISBN}/${this.state.curRating}`, {\n        method: 'GET'\n      }).then(res => res.json()).then(res => {\n        //res is {status: \"success\"} if server -> db is sucessful\n        if (res.status == \"success\") {\n          alert(\"Rating updataed\");\n        } else {\n          alert(\"DB Query Error\");\n        }\n      }).catch(err => console.log(err));\n    }\n  }\n\n  getRelatedBooks(ISBN) {\n    fetch(`http://localhost:8081/relatedBooks/${this.state.ISBN}`, {\n      method: 'GET'\n    }).then(res => res.json()).then(resArray => {\n      console.log(\"aaaa\");\n      console.log(resArray);\n      if (!resArray) return;\n      this.setState({\n        relatedBooks: resArray\n      });\n    }).catch(err => console.log(err));\n    console.log(\"relatedBooks, array\");\n    console.log(this.state.relatedBooks);\n  } //合的时候用zz写的!!!!!\n\n\n  addToBookshelf(ISBN) {} // Go to related book's subpage/info page\n\n\n  goToSubpage(ISBN) {\n    this.setState({\n      ISBN: ISBN\n    });\n  }\n\n  render() {\n    //const {curRating} = this.state;  \n    const responsive = {\n      desktop: {\n        breakpoint: {\n          max: 3000,\n          min: 1024\n        },\n        items: 3,\n        slidesToSlide: 3 // optional, default to 1.\n\n      },\n      tablet: {\n        breakpoint: {\n          max: 1024,\n          min: 464\n        },\n        items: 2,\n        slidesToSlide: 2 // optional, default to 1.\n\n      },\n      mobile: {\n        breakpoint: {\n          max: 464,\n          min: 0\n        },\n        items: 1,\n        slidesToSlide: 1 // optional, default to 1.\n\n      }\n    };\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"Subpage\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(PageNavbar, {\n      active: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container movies-container mt-5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"list-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"list pr-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"list-box bg-white px-3 pt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"list-title mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 11\n      }\n    }, \"\\u2261 Book Information\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"list-row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"img-fluid\",\n      src: this.state.book.image_url_l,\n      alt: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      className: \"my-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 15\n      }\n    }, this.state.book.title), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row ratingRow1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 17\n      }\n    }, \"Average rating: \"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 17\n      }\n    }, this.state.avgRating.toFixed(2))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row ratingRow2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 17\n      }\n    }, \"Your rating: \"), /*#__PURE__*/React.createElement(StarRatingComponent, {\n      name: \"rate2\",\n      editing: true,\n      starCount: 10,\n      value: this.state.curRating,\n      onStarClick: this.onStarClick.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 17\n      }\n    }, this.state.curRating)), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-outline-secondary bg-primary text-white\",\n      type: \"button\",\n      id: \"button-rating\",\n      onClick: this.sumbitRating,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 15\n      }\n    }, \"Submit Your Rating\"), /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 17\n      }\n    }, \"ISBN: \", this.state.ISBN), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 17\n      }\n    }, \"Author: \", this.state.book.author), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 17\n      }\n    }, \"Publisher: \", this.state.book.publisher), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 17\n      }\n    }, \"Year: \", this.state.book.year)), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-outline-secondary bg-primary text-white\",\n      type: \"button\",\n      id: \"button-markBook\",\n      onClick: this.addToBookshelf,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 15\n      }\n    }, \"Like it? Add to bookshelf\"))), /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"list-title mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 11\n      }\n    }, \"\\u2261 Related Books\"), /*#__PURE__*/React.createElement(Carousel, {\n      swipeable: false,\n      draggable: false,\n      showDots: true,\n      responsive: responsive,\n      ssr: true // means to render carousel on server-side.\n      ,\n      infinite: true,\n      autoPlay: this.props.deviceType !== \"mobile\" ? true : false,\n      autoPlaySpeed: 3000,\n      keyBoardControl: true,\n      customTransition: \"all .5\",\n      transitionDuration: 500,\n      containerClass: \"carousel-container\",\n      removeArrowOnDeviceType: [\"tablet\", \"mobile\"],\n      deviceType: this.props.deviceType,\n      dotListClass: \"custom-dot-list-style\",\n      itemClass: \"carousel-item-padding-40-px\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 11\n      }\n    }, this.state.relatedBooks.map((element, index) => {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col md-3\",\n        key: index,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"card-img-top\",\n        src: element.image_url_l,\n        onClick: () => this.goToSubpage(element.ISBN),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 23\n        }\n      }));\n    })))))));\n  }\n\n}\n\nexport default withRouter(Subpage);","map":{"version":3,"sources":["/Users/kejingwang/Desktop/CIS550Database/AllProjects/Project550New/client/src/components/Subpage.js"],"names":["React","withRouter","PageNavbar","StarIcon","StarRatingComponent","Carousel","Subpage","Component","constructor","props","state","username","window","localStorage","getItem","ISBN","location","book","prevRating","curRating","avgRating","relatedBooks","getRelatedBooks","bind","sumbitRating","addToBookshelf","goToSubpage","componentDidMount","fetch","method","then","res","json","resArray","setState","catch","err","console","log","length","rating","onStarClick","nextValue","prevValue","name","alert","status","render","responsive","desktop","breakpoint","max","min","items","slidesToSlide","tablet","mobile","image_url_l","title","toFixed","author","publisher","year","deviceType","map","element","index"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from \"react-router-dom\";\nimport '../style/Subpage.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport PageNavbar from './PageNavbar';\nimport StarIcon from \"../assets/images/star.png\";\nimport StarRatingComponent from 'react-star-rating-component';\nimport Carousel from 'react-multi-carousel';\nimport 'react-multi-carousel/lib/styles.css';\n\nclass Subpage extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      username: window.localStorage.getItem(\"username\"),\n      ISBN: this.props.location.state.ISBN,  //ISBN: from the props.history.push in Dashboard/Rec code, the ISBN of book clicked\n      book: {}, //detailed book info: title, author, publisher, year, image_url_l\n      prevRating: false, //if user previously rated the book \n      curRating: 0, //star num clicked, 0 star means that user hasn't selected anything\n      avgRating: 0, //average rating of this ISBN\n      relatedBooks: [] //contains book info of the same author\n    }\n\n    this.getRelatedBooks = this.getRelatedBooks.bind(this);\n    this.sumbitRating = this.sumbitRating.bind(this);\n    this.addToBookshelf = this.addToBookshelf.bind(this);\n    this.goToSubpage = this.goToSubpage.bind(this);\n  }\n\n  componentDidMount() {\n    //GET BOOK BY ISBN\n    fetch(`http://localhost:8081/book/${this.state.ISBN}`, {\n      method: 'GET' \n    })\n      .then(res => res.json())\n      .then(resArray => {\n        if (!resArray) return;\n        this.setState({\n          book: resArray[0]\n        });\n      })\n      .catch(err => console.log(err))\t// Print the error if there is one. \n\n    //GET AVERAGE RATING BY ISBN\n    fetch(`http://localhost:8081/avgRating/${this.state.ISBN}`, {\n      method: 'GET' \n    })\n      .then(res => res.json())\n      .then(resArray => {\n        if (!resArray) return;\n        this.setState({\n          avgRating: resArray[0].avgRating\n        });\n      })\n      .catch(err => console.log(err))\t// Print the error if there is one.\n\n    //GET PREVIOUS RATING OF USER ON THIS ISBN\n    fetch(`http://localhost:8081/userRating/${this.state.username}/${this.state.ISBN}`, {\n      method: 'GET' \n    })\n      .then(res => res.json())\n      .then(resArray => {\n        if (resArray.length > 0) { //not an empty array\n          this.setState({\n            prevRating: true,\n            curRating: resArray[0].rating\n          });\n        }\n\n      })\n      .catch(err => console.log(err));\n\n    //GET BOOKS OF SAME AUTHOR\n    this.getRelatedBooks();\n  } \n\n    // Send an HTTP request to the server.\n    // fetch(\"http://localhost:8081/genres\", {\n    //   method: 'GET' // The type of HTTP request.\n    // })\n    //   .then(res => res.json()) // Convert the response data to a JSON.\n    //   .then(genreList => {\n    //     if (!genreList) return;\n    //     // Map each genreObj in genreList to an HTML element:\n    //     // A button which triggers the showMovies function for each genre.\n    //     let genreDivs = genreList.map((genreObj, i) =>\n    //       <GenreButton id={\"button-\" + genreObj.genre} onClick={() => this.showMovies(genreObj.genre)} genre={genreObj.genre} />\n    //     );\n\n    //     // Set the state of the genres list to the value returned by the HTTP response from the server.\n    //     this.setState({\n    //       genres: genreDivs\n    //     })\n    //   })\n    //   .catch(err => console.log(err))\t// Print the error if there is one.\n\n  onStarClick(nextValue, prevValue, name) {\n    this.setState({curRating: nextValue});\n  }\n\n  sumbitRating() {    \n    if (!this.state.username) {\n      alert(\"Please log in first!\");\n    } else if (this.state.curRating == 0) {\n      alert(\"Please select a number!\")\n    } else if (!this.state.ISBN) {\n      alert(\"Error\");\n    }\n\n    //if no previous rating exists in db, insertion query\n    if (!this.state.prevRating) {\n      fetch(`http://localhost:8081/submitRating/${this.state.username}/${this.state.ISBN}/${this.state.curRating}`, {\n        method: 'GET'\n      })\n        .then(res => res.json())\n        .then(res => {\n          //res is {status: \"success\"} if server -> db is sucessful\n          if (res.status == \"success\") {\n            this.setState({prevRating: true});\n            alert(\"Rating submitted\");\n          } else {\n            alert(\"DB Query Error\");\n          }\n        })\n        .catch(err => console.log(err));\n\n    //If exists previous rating in db, UPDATE query\n    } else { \n      fetch(`http://localhost:8081/updateRating/${this.state.username}/${this.state.ISBN}/${this.state.curRating}`, {\n        method: 'GET'\n      })\n        .then(res => res.json())\n        .then(res => {\n          //res is {status: \"success\"} if server -> db is sucessful\n          if (res.status == \"success\") {\n            alert(\"Rating updataed\");\n          } else {\n            alert(\"DB Query Error\");\n          }\n        })\n        .catch(err => console.log(err));\n    }\n\n  }\n\n  getRelatedBooks(ISBN) {\n    fetch(`http://localhost:8081/relatedBooks/${this.state.ISBN}`, {\n      method: 'GET' \n    })\n      .then(res => res.json())\n      .then(resArray => {\n        console.log(\"aaaa\");\n        console.log(resArray);\n        if (!resArray) return;\n        this.setState({\n          relatedBooks: resArray\n        });\n      })\n      .catch(err => console.log(err));\n    \n    console.log(\"relatedBooks, array\");\n    console.log(this.state.relatedBooks);\n  }\n\n  //合的时候用zz写的!!!!!\n  addToBookshelf(ISBN) {\n  }\n\n  // Go to related book's subpage/info page\n  goToSubpage(ISBN) {\n    this.setState({ISBN: ISBN});\n  }\n\n  render() {  \n    //const {curRating} = this.state;  \n    const responsive = {\n      desktop: {\n        breakpoint: { max: 3000, min: 1024 },\n        items: 3,\n        slidesToSlide: 3 // optional, default to 1.\n      },\n      tablet: {\n        breakpoint: { max: 1024, min: 464 },\n        items: 2,\n        slidesToSlide: 2 // optional, default to 1.\n      },\n      mobile: {\n        breakpoint: { max: 464, min: 0 },\n        items: 1,\n        slidesToSlide: 1 // optional, default to 1.\n      }\n    };\n\n    return (\n        <div className=\"Subpage\">\n          <PageNavbar active=\"\" />\n          <br></br>\n          <div className=\"container movies-container mt-5\">\n            <div className=\"list-wrap\">\n              <div className=\"list pr-1\">\n                <div className=\"list-box bg-white px-3 pt-3\">\n\n                \n          {/* <!-- Page Content --> */}\n          <h4 className=\"list-title mb-3\">≡ Book Information</h4>\n\n          {/* <!-- Book Info Row --> */}\n          <div className=\"list-row\" >\n            <div className=\"col\">\n              <img className=\"img-fluid\" src={this.state.book.image_url_l} alt=\"\"/>\n            </div>\n        \n            <div className=\"col\">\n              <h3 className=\"my-4\">{this.state.book.title}</h3>\n              <div className=\"row ratingRow1\">\n                {/* <img id=\"starIcon\" src={StarIcon}/>\n                <h6>rating</h6> */}\n                <p>Average rating: </p>\n                <p>{this.state.avgRating.toFixed(2)}</p>\n              </div>\n              <div className=\"row ratingRow2\">\n                <p>Your rating: </p>\n                <StarRatingComponent \n                          name=\"rate2\"\n                          editing={true}\n                          starCount={10}\n                          value={this.state.curRating}\n                          onStarClick={this.onStarClick.bind(this)}\n                />\n                <p>{this.state.curRating}</p>\n              </div>\n              <button\n                  className=\"btn btn-outline-secondary bg-primary text-white\"\n                  type=\"button\"\n                  id=\"button-rating\"\n                  onClick={this.sumbitRating}>\n                  Submit Your Rating\n              </button>\n              {/* <h3 className=\"my-3\">Book Description</h3> */}\n              <ul>\n                <li>ISBN: {this.state.ISBN}</li>\n                <li>Author: {this.state.book.author}</li>\n                <li>Publisher: {this.state.book.publisher}</li>\n                <li>Year: {this.state.book.year}</li>\n              </ul>\n              <button\n                  className=\"btn btn-outline-secondary bg-primary text-white\"\n                  type=\"button\"\n                  id=\"button-markBook\"\n                  onClick={this.addToBookshelf}>\n                  Like it? Add to bookshelf\n              </button>\n            </div>       \n          </div>\n          {/* <!-- /.row --> */}  \n\n\n          <h4 className=\"list-title mb-3\">≡ Related Books</h4>\n          {/* <!-- Related Books Row --> */}        \n          {/* <div className=\"list-row\">\n            {function(this.state.relatedBooks}\n            }\n            <div className=\"col-md-3 col-sm-6 mb-4\">\n              <a href=\"#\">\n                    <img className=\"img-fluid\" src=\"http://placehold.it/500x300\" alt=\"\"/>\n                </a>\n            </div>\n        \n            <div className=\"col-md-3 col-sm-6 mb-4\">\n              <a href=\"#\">\n                    <img className=\"img-fluid\" src=\"http://placehold.it/500x300\" alt=\"\"/>\n                  </a>\n            </div>\n        \n            <div className=\"col-md-3 col-sm-6 mb-4\">\n              <a href=\"#\">\n                    <img className=\"img-fluid\" src=\"http://placehold.it/500x300\" alt=\"\" />\n                  </a>\n            </div>\n        \n            <div className=\"col-md-3 col-sm-6 mb-4\">\n              <a href=\"#\">\n                    <img className=\"img-fluid\" src=\"http://placehold.it/500x300\" alt=\"\" />\n                  </a>\n            </div>\n        \n          </div> */}\n          {/* <!-- /.row --> */}  \n        \n          <Carousel\n            swipeable={false}\n            draggable={false}\n            showDots={true}\n            responsive={responsive}\n            ssr={true} // means to render carousel on server-side.\n            infinite={true}\n            autoPlay={this.props.deviceType !== \"mobile\" ? true : false}\n            autoPlaySpeed={3000}\n            keyBoardControl={true}\n            customTransition=\"all .5\"\n            transitionDuration={500}\n            containerClass=\"carousel-container\"\n            removeArrowOnDeviceType={[\"tablet\", \"mobile\"]}\n            deviceType={this.props.deviceType}\n            dotListClass=\"custom-dot-list-style\"\n            itemClass=\"carousel-item-padding-40-px\"\n          >\n            {this.state.relatedBooks.map((element, index) => {\n              return (\n                  <div className=\"col md-3\" key={index}>\n                      <img className=\"card-img-top\" src={element.image_url_l} onClick={()=>this.goToSubpage(element.ISBN)}/>\n                  </div>\n              );\n            })}\n          </Carousel>\n\n\n        </div>\n        </div>\n        </div>\n        </div>\n        </div>\n    );\n  }\n}\nexport default withRouter(Subpage);\n"]},"metadata":{},"sourceType":"module"}